<!DOCTYPE html>
<html lang="en-us">

<head><title>
    NLog | 
    
    My New Hugo Site</title>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="description" content="A description for the meta tag of the site
    ">


<meta property="og:title" content="NLog" />
<meta property="og:description" content="A description for the meta tag of the site" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://example.org/tags/nlog/" />
<meta property="og:updated_time" content="2014-09-18T17:33:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="NLog"/>
<meta name="twitter:description" content="A description for the meta tag of the site"/>

<meta itemprop="name" content="NLog">
<meta itemprop="description" content="A description for the meta tag of the site">

<link rel="canonical" href="http://example.org/tags/nlog/" />

<link rel="icon" type="image/png" href="http://example.org/image/favicon.ico">

<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/bulma.min.css">





<script src=/js/ramium.js></script>
<link rel="stylesheet" href=/css/ramium.css>






<script data-ad-client="ca-pub-5338947003335320" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body><nav class="navbar is-dark" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href=/>
      
      <strong>My New Hugo Site </strong>
      
    </a>

    <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
      data-target="navbarBasicExample">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicExample" class="navbar-menu">
    <div class="navbar-start">
      
      
      <a class="navbar-item" href="/">Home</a>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">This Blog</a>
        <div class="navbar-dropdown">
          
          <a class="navbar-item" href="/tags/">All Tags</a>
          
          <a class="navbar-item" href="/sections/">All Sections</a>
          
          <a class="navbar-item" href="/posts/">All Posts</a>
          
        </div>
      </div>
      
      
    </div>

    <div class="navbar-end">
      
      <a class="navbar-item navgithub" href="https://github.com/rafed/ramium/" target="_blank">
        <i class="fa fa-github fa-2x"></i>
      </a>
      

      
    </div>
  </div>
</nav><div class="columns is-centered">
        <div id="page-body" class="column is-7">

<div class="content">
    <h1>NLog</h1>
</div>

<div class="blog-brief">
    <a href="/posts/2012/12/nlog-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/">
        <h3 class="title is-4">
            NLog 學習筆記
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/">
                    <p class="subtitle info date">Dec 30, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/">
                    <p class="subtitle info">
                        2 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/">
                <p class="summary">
                    一套好用的Logging工具在開發和日後維護上很有幫助，之前一直用的是log4net，雖然功能強大，但層級式的設定檔比較複雜不容易掌握，而且相關的中文資源也不是很多
後來找到NLog這個套件，Google一下很快就上手了，而且也有不少詳細的中文資料，擴充功能也很簡單，在此記錄一下學習筆記和參考資料
NLog學習筆記 1. [NLog 初體驗](http://blog.developer.idv.tw/2012/12/nlog.html)     NLog的安裝、設定、和使用 2. NLog Config NLog的設定檔作用和內容
3.NLog Targets Nlog的輸出目標
4. NLog Rules NLog的輸出的路由規則
5. NLog Layout NLog的輸出格式
6. 好用的Log Viewer
7. Common.Logging
8. 個人常用Log格式
9. NLog Database Target
10. ELMAH
11. NLog.Elmah
參考資料 [NLog官網](http://nlog-project.org/) [NLog Document](https://github.com/nlog/nlog/wiki)  [mrkt 的程式學習筆記 - 系統記錄與效能監測](http://kevintsengtw.blogspot.tw/p/blog-page_12.html#.UN59kqxcUep) Dflying Chen @ cnblogs - NLog系列
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div><div class="blog-brief">
    <a href="/posts/2012/12/nlog-layouts/">
        <h3 class="title is-4">
            NLog Layouts
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-layouts/">
                    <p class="subtitle info date">Dec 30, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-layouts/">
                    <p class="subtitle info">
                        2 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-layouts/">
                <p class="summary">
                    NLog Layouts Layout是用來決定記錄的訊息輸出的格式，通常設定在target的屬性中這個功能可以讓我們動態增減日誌的內容，而不用回頭修改程式碼和重新編譯使用方法是$字號和左右大括號，包住Layout Renderers參數的使用方法則是冒號分隔，屬性=值的方式預設的輸出格式如下 ${longdate}|${level:uppercase=true}|${logger}|${message}    Layout Renderers   ${basedir} - 應用程式所在的資料庫 ${callsite} - 日誌來源的類別名稱、方法名稱和來源資訊 ${data} - 目前日期和時間 ${exception} - 例外的訊息 ${level} - 日誌的級別 ${logger} - 日誌的來源 ${logdate} - 長日期格式，yyyy-MM-dd HH:mm:ss.mmm ${machinename} - 電腦名稱 ${message} - 日誌的內容 ${newline} - 換行符號 ${shortdate} - 短日期格式 yyyy-MM-dd ${stacktrace} - 呼叫堆疊資訊 ${time} - 時間格式，HH:mm:ss.mmm. ${windows-identity} - 登入帳號每一個Layout Renderers還包含各自的屬性，詳細的內容可以參考官網Layout Renderers文件   Pre-Defined Layouts NLog還包含了幾個預設定義好的格式，詳細的文件請參考官網的Layout文件
 CsvLayout - CSV格式 LayoutWithHeaderAndFooter - 加上Header和Footer的格式 Log4JXmlEventLayout - Log4j相容的格式 SimpleLayout - 簡單的文字內容格式  上一篇 : [NLog Rules](http://blog.
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-layouts/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div><div class="blog-brief">
    <a href="/posts/2012/12/nlog-rules/">
        <h3 class="title is-4">
            NLog Rules
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-rules/">
                    <p class="subtitle info date">Dec 30, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-rules/">
                    <p class="subtitle info">
                        4 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-rules/">
                <p class="summary">
                    NLog Rules NLog使用一個簡單的路由表檢查當檢查到符合的日誌名稱和級別時，會輸出到指定的一個或多個Target去如果指定了final屬性，之後的規則就不再檢查Rules可以使用的屬性如下   name - 日誌來源的名稱(允許使用通配符號*) minlevel - 設定符合該規則的最低級別 maxlevel - 設定符合該規則的最高級別 level - 設定符合該規則的特定級別 levels - 設定符合該規則的級別列表，用逗號分隔 writeTo - 設定符合該規則的日誌要寫入的target列表，用逗號分隔 final - 設定符合該規則的條件為最後一個規則，後面的規則不再檢查以下為一些例子&lt;!– 命名空間Name.Space下的Class1這個類別的日誌，符合Debug以上的級別，就輸出到f1這個Target –&gt; &lt;logger name=&#34;Name.Space.Class1” minlevel=&#34;Debug” writeTo=&#34;f1” /&gt;  &lt;!– 命名空間Name.Space下的Class1這個類別的日誌，符合Debug和Error這兩個級別，就輸出到f1這個Target –&gt; &lt;logger name=&#34;Name.Space.Class1” levels=&#34;Debug,Error” writeTo=&#34;f1” /&gt;
&lt;!– 命名空間Name.Space下的所有類別的日誌，就輸出到f3和f4這兩個Target –&gt; &lt;logger name=&#34;Name.Space.*” writeTo=&#34;f3,f4” /&gt;
&lt;!– 命名空間Name.Space下的所有類別的日誌，級別在Debug和Error之間 也就是說級別為Debug, Info, Warn, Error，不輸出日誌，因為這條規則沒有指定writeTo 同時不再檢查之後的規則，因為這裡設定final=true –&gt; &lt;logger name=&#34;Name.Space.*” minlevel=&#34;Debug” maxlevel=&#34;Error” final=&#34;true” /&gt; 
 NLog Level NLog的日誌級別分為六個等級，方便我們對於不同情境制訂出合適的級別輸出
 Trace - 大量而詳細的訊息，一般只用在開發環境 Debug - 用來除錯用的詳細訊息，比Trace用的少一點，一般也只用在開發環境 Info - 用來提示用的訊息，例如使用者登出入，交易參數資料 Warn - 用來警告用的訊息，例如執行時間超出預期，連線數接近上限 Error - 一般錯誤的訊息，一般就是try catch到的Exception Fatal - 致命錯誤的訊息，通常會造成應用程式無法執行最簡單的設定檔配置，只要設定Rule和要寫入的Target就行了 上一篇: NLog Targets 下一篇: NLog Layouts   
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-rules/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div><div class="blog-brief">
    <a href="/posts/2012/12/nlog-targets/">
        <h3 class="title is-4">
            NLog Targets
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-targets/">
                    <p class="subtitle info date">Dec 30, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-targets/">
                    <p class="subtitle info">
                        6 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-targets/">
                <p class="summary">
                    NLog Targets target用來定義Log的輸出目標，基本的兩個屬性為
 name - 目標的名稱，用來給rule路由指定的名稱 type - 目標的類型，NLog支援的類型很多，完整資料請參考官網Supported Targets文件每一個target元素代表一個輸出目標，只要name屬性值不衝突即可  &lt;targets&gt; &lt;target name=&#34;f1&#34; xsi:type=&#34;File&#34; fileName=&#34;file1.txt&#34;/&gt; &lt;target name=&#34;f2&#34; xsi:type=&#34;File&#34; fileName=&#34;file2.txt&#34;/&gt; &lt;target name=&#34;n1&#34; xsi:type=&#34;Network&#34; address=&#34;tcp://localhost:4001&#34;/&gt; &lt;target name=&#34;ds&#34; xsi:type=&#34;OutputDebugString&#34;/&gt; &lt;/targets&gt;  依照type的不同，會有相對應的屬性，例如 File需要指定FileName檔名 Database需指定資料庫相關的參數和語法 Mail需指定郵件主機等資訊 每種類型的設定方式，之後再來詳細介紹
 自訂target 要自行擴充target可以參考官網文件的How to write a target 只要繼承NLog的TargetWithLayout類別，覆寫Write(LogEventInfo logEvent)函式 再利用extensions元素或在程式碼中註冊就行了
 Wrapper Targets NLog提供幾個封裝和複合目標，用來增加target的功能  asynchronous processing (非同步功能，被封裝的target會由另一個執行緒來運行) retry-on-error(自動重試功能) buffering(緩衝處理，不會馬上寫出Log，而會依設定值累積一定數量才輸出Log) filtering(過濾條件，會依設定值決定是否輸出Log)更多詳細功能請參考官網的Wrapper Targets文件  Wrapper可以連續嵌套，以下的範例可以增加非同步和自動重試的功能&lt;targets&gt; &lt;!-- 增加非同步功能--&gt; &lt;target name=&#34;n&#34; xsi:type=&#34;AsyncWrapper&#34;&gt; &lt;!-- 增加自動重試功能 --&gt; &lt;target xsi:type=&#34;RetryingWrapper&#34;&gt; &lt;target xsi:type=&#34;
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-targets/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div><div class="blog-brief">
    <a href="/posts/2012/12/nlog-config/">
        <h3 class="title is-4">
            NLog Config
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-config/">
                    <p class="subtitle info date">Dec 29, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-config/">
                    <p class="subtitle info">
                        6 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-config/">
                <p class="summary">
                    NLog設定檔位置 NLog的設定檔有幾個位置，參考官網文件如下
 應用程式的標準設定檔(app.config或是web.config) 執行過程中如果需要修改NLog的配置，會造成應用程式重新啟動 應用程式所在目錄的app.exe.nlog 每個專案都要手動指定檔名比較麻煩點 應用程式所在目錄的NLog.config 建議使用的設定檔方式 Nlog.dll所在目錄的NLog.dll.config 和第三種方式差不多，還是選擇比較常見的第三種方式吧 環境變數NLOG_GLOBAL_CONFIG_FILE指定的檔案 設在這種神秘的地方，應該會被扁吧在ASP.NET或是Windows Form應用程式中有點差異，其他的專案類型有幾種方式不能用，所以建議使用最通用的第三種方式   NLog設定檔元素 Nlog的設定檔有以下五種元素，前兩種是必要項目，後三種是可選項目  targets - 定義Log的輸出目標，輸出格式的Layout也在這裡設定 rules - 定義Log的路由規則，Log的過濾條件也在這裡設定 extensions - 定義擴充元件，包含NLog擴充模組和自定義的擴充模組 include - 引用外部設定檔，簡化設定檔的複雜度和重覆利用 variable - 定義設定檔中自行設定的變數，可以統一和簡化設定檔資料   NLog設定檔自動重讀 NLog的設定檔，在執行過程中預設是不會重讀的，每個修改都需要重新啟動應用程式才能生效 如果要自動重讀的話，需要設定一個屬性autoReload=&#34;true&#34;才能生效
&lt;nlog autoreload=&#34;true&#34;&gt; ... &lt;/nlog&gt;   NLog設定檔疑難排解 有時後就算設好了設定檔，Log還是沒有寫出來，最常見的原因是權限問題造成的問題例如ASP.NET的w3wp.exe沒有指定資料夾寫檔案的權限這時後可以利用NLog內部的Log來查詢原因  throwExceptions - 設定是否要引發錯誤 NLog會吃掉所有內部引發的錯誤，要找問題時可以設為true，找到之後應該設回false internalLogFile - 設定內部錯誤要輸出的文件位置 直接給一個檔名就好，會輸出在執行檔所在目錄下面 internalLogLevel - 設定內部錯誤要輸出的層級 基本上要找的是Error訊息比較簡潔點，不設定的話會輸出所有詳細訊息 internalLogToConsole - 設定內部錯誤是否要輸出到Console視窗 如果不想寫檔，又有Console可以用的話，那就設定為true吧 internalLogToConsoleError - 設定內部錯誤是否要輸出到stderr串流 為了不要和應用程式正常訊息混在一起，可以把錯誤訊息重導向到stderr  上一篇 : [NLog 初體驗](http://blog.
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-config/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div><div class="blog-brief">
    <a href="/posts/2012/12/nlog-%E5%88%9D%E9%AB%94%E9%A9%97/">
        <h3 class="title is-4">
            NLog 初體驗
        </h3>
    </a>

    <div class="level is-mobile details">
        <div class="level-left">

            
            <div class="level-item">
                <a href="/posts/2012/12/nlog-%E5%88%9D%E9%AB%94%E9%A9%97/">
                    <p class="subtitle info date">Dec 29, 2012
                    </p>
                </a>
            </div>
            


            <div class="level-item">
                <a href="/posts/2012/12/nlog-%E5%88%9D%E9%AB%94%E9%A9%97/">
                    <p class="subtitle info">
                        8 mins read
                    </p>
                </a>
            </div>
        </div>
        <div class="level-right is-hidden-touch">
            
            <a class="tag is-rounded" href="/tags/nlog">NLog</a>
            
        </div>
    </div>

    <div>
        

        <div>
            <a href="/posts/2012/12/nlog-%E5%88%9D%E9%AB%94%E9%A9%97/">
                <p class="summary">
                    先簡單介紹一下如何安裝NLog這個套件，和使用預設的設定檔來寫出Log首先讓環境簡單點，所以開一個主控台專案來當範例[![](http://1.bp.blogspot.com/-kY84lmK8n-Y/UN6LxFGNSKI/AAAAAAAAAls/avloE2j0DDU/s1600/01.NLogApp.png)](http://1.bp.blogspot.com/-kY84lmK8n-Y/UN6LxFGNSKI/AAAAAAAAAls/avloE2j0DDU/s1600/01.NLogApp.png) 接下來引用NLog最簡單的方式當然就是用NuGet安裝了如果對NuGet不熟的話，可以參考之前的[NuGet學習筆記](http://blog.developer.idv.tw/2012/12/nuget.html)NLog這個套件是NLog.dll元件本身 NLog.Config這個套件是NLog.config和NLog.xsd(用來幫助在設定檔中的IntelliSense) [![](http://1.bp.blogspot.com/-q64xvtDQs48/UN6NL4Ig1YI/AAAAAAAAAmU/ZbCqaqjTbi0/s1600/02.NugetInstall.png)](http://1.bp.blogspot.com/-q64xvtDQs48/UN6NL4Ig1YI/AAAAAAAAAmU/ZbCqaqjTbi0/s1600/02.NugetInstall.png)安裝好後，專案中就會多了這三個東西 [![](http://1.bp.blogspot.com/-JPz6V3bHo4Y/UN6NW6sNdhI/AAAAAAAAAmc/rLoiSFWHldA/s1600/03.SolutionExplorer.png)](http://1.bp.blogspot.com/-JPz6V3bHo4Y/UN6NW6sNdhI/AAAAAAAAAmc/rLoiSFWHldA/s1600/03.SolutionExplorer.png) 打開設定檔，把註解拿掉，先使用預設值來體驗一下 詳細的設定方式，之後再介紹 &lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34; ?&gt; &lt;nlog xmlns=&#34;http://www.nlog-project.org/schemas/NLog.xsd&#34;       xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;&gt;     &lt;!--   See http://nlog-project.org/wiki/Configuration_file   for information on customizing logging rules and outputs.    --&gt;     &lt;targets&gt;         &lt;!-- add your targets here --&gt;         &lt;target xsi:type=&#34;File&#34; name=&#34;f&#34; fileName=&#34;${basedir}/logs/${shortdate}.log&#34;             layout=&#34;${longdate} ${uppercase:${level}} ${message}&#34; /&gt;     &lt;/targets&gt;     &lt;rules&gt;         &lt;!
                    
                </p>
            </a>
        </div>
    </div>

    <div class="level is-mobile continue-reading">
        <div class="level-left">
        </div>
        <div class="level-right">
            <a href="/posts/2012/12/nlog-%E5%88%9D%E9%AB%94%E9%A9%97/">Continue reading <i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
        </div>
    </div>
    <hr>
</div>





















        </div>
    </div>

<footer class="footer has-background-dark">
    <div class="content has-text-centered has-text-white">
        <p>
            © 2020 Ramium. Powered by
            <a class="has-text-light" href="https://github.com/gohugoio/hugo" target="_blank">
            Hugo</a>. Theme
            <a class="has-text-light" href="https://github.com/rafed123/ramium/" target="_blank">
                Ramium.
            </a>
        </p>
    </div>
</footer>
</body>

</html>